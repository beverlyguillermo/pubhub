/*
  Epic Image Zoom v1.1
  (c) 2011. Web factory Ltd
  http://www.webfactoryltd.com/
  Sold exclusively on CodeCanyon
  
  05/25/2012 { Jen Wachter } added touch screen support
  
**/(function(a){a.fn.epicZoom=function(b){function d(a){return a.targetTouches?a.targetTouches[0].pageX:a.pageX}function e(a){return a.targetTouches?a.targetTouches[0].pageY:a.pageY}var c=a("body");a.event.props.push("targetTouches");var f={isInBounds:function(a,b,c,f){var g=d(a),h=e(a);return g<b.left+f.left||g>b.left+c.width+f.left||h<b.top+f.top||h>b.top+c.height+f.top?!1:!0},isDebug:function(){return b.debug&&typeof console!="undefined"?!0:!1}},g={size:150,border:"1px solid white",largeImage:"",magnification:1,hideCursor:!0,blankCursor:"./js/blank.png",newPosition:!1,debug:!1};b=a.extend(g,b);b.debug=Boolean(b.debug);f.isDebug()&&console.warn("Epic Image Zoom debugging is enabled.");b.size=parseInt(b.size,10);b.magnification=parseFloat(b.magnification);b.hideCursor=Boolean(b.hideCursor);b.largeImage=a.trim(b.largeImage);b.blankCursor=a.trim(b.blankCursor);b.newPosition=Boolean(b.newPosition);f.isDebug()&&console.log("EIZ; options: ",b);return this.each(function(){var g=a(this);if(!g.is("img")){f.isDebug()&&console.error("EIZ works only on img elements.");return this}var h=a("<img />");b.largeImage?h.attr("src",b.largeImage):h.attr("src",g.attr("src"));h.load(function(){function r(a){f.isDebug()&&console.log("EIZ #"+i+": mouse enter container");if(!f.isInBounds(a,o,p,q))return!1;k.stop(!0,!0).show()}function s(a){var c=d(a),h=e(a);if(!f.isInBounds(a,o,p,q)){if(!k.is(":animated")){f.isDebug()&&console.log("EIZ #"+i+": out of bounds");j.trigger("mouseleave")}return!1}k.is(":not(:animated):hidden")&&j.trigger("mouseenter");if(!b.newPosition){k.css("left",c-b.size/2);k.css("top",h-b.size/2);m.css("left",-1*(c-o.left-q.left)*n+b.size/2);m.css("top",-1*(h-o.top-q.top)*n+b.size/2)}else{k.css("left",c-b.size/2-g.offset().left);k.css("top",h-b.size/2-g.offset().top);m.css("left",-1*(c-q.left-o.left)*n+b.size/2);m.css("top",-1*(h-q.top-o.top)*n+b.size/2)}}function t(){k.stop(!0,!0).hide()}if(h.hasInit)return!1;h.hasInit=!0;typeof c.data("epicZoom-nb")=="undefined"&&c.data("epicZoom-nb",0);c.data("epicZoom-nb",c.data("epicZoom-nb")+1);var i=c.data("epicZoom-nb");f.isDebug()&&console.log("EIZ; #",i);g.wrap('<span id="eiz-'+i+'" class="eiz-container"></span>');var j=a("#eiz-"+i).css("margin",0).css("padding",0).css("border",0);j.append('<span class="eiz-magnifier"></span>');var k=a(".eiz-magnifier",j).css("position","absolute").css("margin",0).css("padding",0).css("border",b.border).css("-moz-box-shadow","0 0 5px #777, 0 0 10px #aaa inset").css("-webkit-box-shadow","0 0 5px #777").css("box-shadow","0 0 5px #777, 0 0 10px #aaa inset").css("overflow","hidden").css("z-index",20).css("width",b.size+"px").css("height",b.size+"px");k.append('<div><img alt="" title="" /></div>');var l=a("img",k).css("margin",0).css("padding",0).css("max-width","none").css("border",0);b.largeImage?l.attr("src",b.largeImage):l.attr("src",g.attr("src"));b.hideCursor&&l.css("cursor","none").css("cursor","url("+b.blankCursor+"),none !important;");var m=a("div",k).css("position","absolute").css("margin",0).css("padding",0).css("border",0).css("z-index",1).css("overflow","hidden");l.width(l.width()*b.magnification);var n=l.width()/g.width(),o={left:g.offset().left,top:g.offset().top},p={width:g.width(),height:g.height()},q={top:parseInt(g.css("padding-top"),10),right:parseInt(g.css("padding-right"),10),bottom:parseInt(g.css("padding-bottom"),10),left:parseInt(g.css("padding-left"),10)};k.hide();a(window).resize(function(){o={left:g.offset().left,top:g.offset().top};p={width:g.width(),height:g.height()};f.isDebug()&&console.log("EIZ #"+i+": window resized, vars recalculated")});j.live("mousemove touchmove",s);j.live("mouseenter touchstart",r);j.live("mouseleave touchend",t);j.live("mousedown touchmove",function(a){a.preventDefault()})});(h.complete||h.naturalWidth>0)&&h.trigger("load")})}})(jQuery);