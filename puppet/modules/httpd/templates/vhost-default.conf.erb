# ***************************************************
# Default vhost template
# Managed by Puppet
# ***************************************************

#Listen <%= @port %>
#NameVirtualHost <%= @vhost_name %>:<%= @port %>
<VirtualHost <%= @vhost_name %>:<%= @port %>>
    <% if @port == '443' -%>
        SSLEngine on
        SSLCertificateFile /etc/pki/tls/certs/ca.crt
        SSLCertificateKeyFile /etc/pki/tls/private/ca.key
    <% end -%>
    ServerName <%= @srvname %>
    <% if @serveraliases.is_a? Array -%>
        <% @serveraliases.each do |name| -%>
            <%= "  ServerAlias #{name}\n" %>
        <% end -%>
    <% elsif @serveraliases != '' -%>
        <%= "  ServerAlias #{serveraliases}" %>
    <% end -%>
    DocumentRoot <%= @docroot %>
    <Directory <%= @docroot %>>
        Options <%= @options %>
        AllowOverride All
        Order allow,deny
        allow from all
    </Directory>
    <% if @shibboleth != '' -%>
    <Location <%= @shibboleth %>>
        AuthType Shibboleth
        ShibRequestSetting requireSession 1
        require valid-user
    </Location>
    <% end -%>
    ErrorLog <%= @logdir %>/<%= @name %>_error.log
    LogLevel warn
    CustomLog <%= @logdir %>/<%= @name %>_access.log combined
    ServerSignature Off
</VirtualHost>

